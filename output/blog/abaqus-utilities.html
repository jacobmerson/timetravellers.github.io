<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" >
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Computational Mechanics">
    <meta name="author" content="Jacob Merson">

    <!-- styles -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
    <link href="/css/footer.css" rel="stylesheet">
    <link href="/css/blog.css" rel="stylesheet">
    <!-- Style for code syntax highlighting -->
    <link href="/css/highlighting.css" rel="stylesheet">
    <link href="/css/mathjax.css" rel="stylesheet">
    
    
    
	<title>Jacob Merson | Abaqus Utilities</title>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <!--[if lt IE 9]>
        <script src="/js/response.min.js"></script>
        <script src="/js/html5.shif.js"></script>
    <![endif]-->

    <!--Add mathjax capability-->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            extensions: ["tex2jax.js"],
            jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
        },
        "HTML-CSS": { availableFonts: ["TeX"] }
        });
        MathJax.Hub.Queue(function() {
            // Fix <code> tags after MathJax finishes running. This is a
            // hack to overcome a shortcoming of Markdown. Discussion at
            // https://github.com/mojombo/jekyll/issues/199
            var all = MathJax.Hub.getAllJax(), i;
            for(i = 0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
  </head>

  <body>
    <div id=wrap>
        <nav class="navbar navbar-default" role=naviagation>
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jm-navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="index.html">Jacob Merson</a>
                </div>
                <div class="collapse navbar-collapse" id="jm-navbar">
                    <ul class="nav navbar-nav">
                            <li> 
                                <a href="/index.html">Home</a>
                            </li>
                            <li> 
                                <a href="/about.html">About</a>
                            </li>
                            <li> 
                                <a href="/resume.html">Resume</a>
                            </li>
                            <li> 
                                <a href="/blog/index.html">Blog</a>
                            </li>
                            <li> 
                                <a href="/contact.html">Contact</a>
                            </li>
                    </ul>
                </div>
        </nav>

    <div class="container">

        <div id="main">
            
<div class="container">
<div class="blog-header">
    <h1 class="blog-post-title"> Abaqus Utilities </h1>
    <p class="blog-post-date"> Sunday January 18, 2015 </p>
    <p class="blog-post-tags">  abaqus  queue  bash  python  </p>
</div> <!-- blog header --!>
<div class="blog-main">
    
        <div class="blog-post-content">
            <p class="lead"><p>Note: I will try to keep this page up to date, but I won't guarantee it. Updated software is kept in the git repository <a href="https://gitlab.com/jacob.merson/abaqus-utilities">here</a>. If you use this software and want to help me improve it please submit a merge request.</p>
<p>I am releasing these quick an dirty for today. These are two scripts that I use all the time working with Abaqus.</p>
<h2>Abaqus Queue</h2>
<p>This is a queue for running abaqus jobs. The easiest way to use this is by linking the script to a convenient bin location like <code>~/bin</code>. Once this is done you can call the script with all of the jobs you want to run and they will run sequentially.</p>
<p>Here is the whole list of commands you would need to get starting running abaqus jobs.</p>
<div class="codehilite"><pre>git clone https://gitlab.com/jacob.merson/abaqus-utilities.git
ln -s abaqus-utilities/run_analysis.sh ~/bin/run_analysis.sh
chmod +x ~/bin/run_analysis.sh
</pre></div>


<p>Now make sure that you have the <code>~/bin</code> folder in your path. You should see the following in your <code>~.bashrc</code></p>
<div class="codehilite"><pre><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$HOME</span>/bin
</pre></div>


<p>Now you should be able to run abaqus jobs in any folder on your system. Change to a folder with a bunch of input files that you want to run and try using the queue.</p>
<div class="codehilite"><pre>run_analysis.sh *.inp
</pre></div>


<h3>Script</h3>
<div class="codehilite"><pre><span class="c">#!/usr/bin/env bash</span>
<span class="c">#</span>
<span class="c"># run_analysis.sh</span>
<span class="c"># </span>
<span class="c"># Copyright 2015 Jacob Merson &lt;jacob.merson@gmail.com&gt; </span>
<span class="c"># </span>
<span class="c"># This program is free software: you can redistribute it and/or modify</span>
<span class="c"># it under the terms of the GNU General Public License as published by</span>
<span class="c"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c"># (at your option) any later version.</span>
<span class="c"># </span>
<span class="c"># This program is distributed in the hope that it will be useful,</span>
<span class="c"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c"># GNU General Public License for more details.</span>
<span class="c"># </span>
<span class="c"># You should have received a copy of the GNU General Public License</span>
<span class="c"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c">#</span>

<span class="nv">TIME</span><span class="o">=</span><span class="k">$(</span>date +<span class="s2">&quot;%x %r %Z&quot;</span><span class="k">)</span>
<span class="c">#time after which to kill the simulation</span>
<span class="c">#in hours</span>
<span class="nb">declare</span> -i <span class="nv">SIMULATION_DURATION</span><span class="o">=</span>1
<span class="c">#convert duration to seconds</span>
<span class="nv">SIMULATION_DURATION</span><span class="o">=</span><span class="nv">$SIMULATION_DURATION</span>*3600
<span class="nv">EMAIL</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$USER</span><span class="s2">&quot;</span>
<span class="nv">MESSAGE</span><span class="o">=</span><span class="s2">&quot;message.txt&quot;</span>
<span class="nb">declare</span> -i <span class="nv">TERMINATED</span><span class="o">=</span>0

<span class="k">function</span> kill_job<span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">&quot;Terminating </span><span class="nv">$1</span><span class="s2"> at </span><span class="nv">$TIME</span><span class="s2">&quot;</span>
    abaqus terminate <span class="nv">job</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
    <span class="nv">SUBJECT</span><span class="o">=</span><span class="s2">&quot;Job </span><span class="nv">$1</span><span class="s2"> terminated at </span><span class="nv">$TIME</span><span class="s2">&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;Job </span><span class="nv">$1</span><span class="s2"> terminated at </span><span class="nv">$TIME</span><span class="s2">&quot;</span> &gt;&gt; <span class="nv">$MESSAGE</span>
<span class="o">}</span>

<span class="k">for</span> f in <span class="nv">$@</span>
<span class="k">do</span>
    <span class="nv">TIME</span><span class="o">=</span><span class="k">$(</span>date +<span class="s2">&quot;%x %r %Z&quot;</span><span class="k">)</span>
    <span class="nb">echo</span> <span class="s2">&quot;Starting job=</span><span class="nv">$f</span><span class="s2"> at </span><span class="nv">$TIME</span><span class="s2">&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;Starting job=</span><span class="nv">$f</span><span class="s2"> at </span><span class="nv">$TIME</span><span class="s2">&quot;</span> &gt; <span class="nv">$MESSAGE</span>
    <span class="c">#set trap to cleanly take care of shutting abaqus down</span>
    <span class="nb">trap</span> <span class="s2">&quot;kill_job </span><span class="nv">$f</span><span class="s2">&quot;</span> SIGINT
    abaqus <span class="nv">job</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$f</span><span class="s2">&quot;</span> <span class="nv">ask_delete</span><span class="o">=</span>off
    <span class="c">#sleep for 20 sec to allow abaqus to start</span>
    sleep 20
    <span class="c">#while the lock file exists (simulation running)</span>
    <span class="c">#sleep for 5 sec at a time</span>
    <span class="k">while</span> <span class="o">[</span> -f <span class="si">${</span><span class="nv">f</span><span class="si">}</span>.lck <span class="o">]</span><span class="p">;</span> <span class="k">do</span>
        sleep 5
        <span class="nv">SIMULATION_DURATION</span><span class="o">=</span><span class="nv">$SIMULATION_DURATION</span>-5
        <span class="c">#if the simulation has been running for more than the specified time</span>
        <span class="c">#Cleanly terminate the job</span>
        <span class="k">if</span> <span class="o">[</span> <span class="nv">$SIMULATION_DURATION</span> -lt <span class="m">0</span> <span class="o">]</span>
            <span class="k">then</span>
        <span class="nv">TIME</span><span class="o">=</span><span class="k">$(</span>date +<span class="s2">&quot;%x %r %Z&quot;</span><span class="k">)</span>
                kill_job <span class="s2">&quot;</span><span class="nv">$f</span><span class="s2">&quot;</span>
                <span class="nv">TERMINATED</span><span class="o">=</span>1
                <span class="nb">break</span>
<span class="nb">        </span><span class="k">fi</span>
    <span class="k">done</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$TERMINATED</span> -eq <span class="m">0</span> <span class="o">]</span>
    <span class="k">then</span>
        <span class="nv">TIME</span><span class="o">=</span><span class="k">$(</span>date +<span class="s2">&quot;%x %r %Z&quot;</span><span class="k">)</span>
        <span class="nv">SUBJECT</span><span class="o">=</span><span class="s2">&quot;Job </span><span class="nv">$f</span><span class="s2"> Completed at </span><span class="nv">$TIME</span><span class="s2">&quot;</span>
        <span class="nb">echo</span> <span class="s2">&quot;Job </span><span class="nv">$f</span><span class="s2"> Completed at </span><span class="nv">$TIME</span><span class="s2">&quot;</span> &gt;&gt; <span class="nv">$MESSAGE</span>
    <span class="k">fi</span>
    mail -a <span class="s2">&quot;</span><span class="nv">$f</span><span class="s2">.dat&quot;</span> -a <span class="s2">&quot;</span><span class="nv">$f</span><span class="s2">.sta&quot;</span> -s <span class="s2">&quot;</span><span class="nv">$SUBJECT</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$EMAIL</span><span class="s2">&quot;</span> &lt; <span class="nv">$MESSAGE</span>
<span class="k">done</span>

rm <span class="s2">&quot;message.txt&quot;</span>
</pre></div>


<h2>Cleanup Script</h2>
<p>This script is a very simple python utility that cleans up all of the abaqus temporary files when you are done with them.</p>
<div class="codehilite"><pre>ln -s abaqus-utilities/clean_abaqus.py ~/bin/clean_abaqus.py
chmod +x ~/bin/clean_abaqus.py
</pre></div>


<p>Change to the directory where you ran all of your jobs and all of the files with the extensions listed in the script will be gone. No more wasting time deleting all of those files Abaqus generates.</p>
<div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c">#</span>
<span class="c"># clean_abaqus.py</span>
<span class="c"># </span>
<span class="c"># Copyright 2015 Jacob Merson &lt;jacob.merson@gmail.com&gt; </span>
<span class="c"># </span>
<span class="c"># This program is free software: you can redistribute it and/or modify</span>
<span class="c"># it under the terms of the GNU General Public License as published by</span>
<span class="c"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c"># (at your option) any later version.</span>
<span class="c"># </span>
<span class="c"># This program is distributed in the hope that it will be useful,</span>
<span class="c"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c"># GNU General Public License for more details.</span>
<span class="c"># </span>
<span class="c"># You should have received a copy of the GNU General Public License</span>
<span class="c"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c">#</span>

<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c">##############</span>
<span class="c"># This file removes all of the standard abaqus files from</span>
<span class="c"># the current directory</span>
<span class="c">##############</span>

<span class="c">#specify files to delete with glob syntax</span>
<span class="n">file_types</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;*.sta&#39;</span><span class="p">,</span> <span class="s">&#39;*.dat&#39;</span><span class="p">,</span> <span class="s">&#39;*.log&#39;</span><span class="p">,</span><span class="s">&#39;*.rpy&#39;</span><span class="p">,</span><span class="s">&#39;*.rpy.*&#39;</span><span class="p">,</span> <span class="s">&#39;*.msg&#39;</span><span class="p">,</span> <span class="s">&#39;*.dat&#39;</span><span class="p">,</span>
              <span class="s">&#39;*.com&#39;</span><span class="p">,</span> <span class="s">&#39;*.sim&#39;</span><span class="p">,</span><span class="s">&#39;*.log&#39;</span><span class="p">,</span><span class="s">&#39;*.msg&#39;</span><span class="p">,</span> <span class="s">&#39;*.prt&#39;</span><span class="p">,</span> <span class="s">&#39;*.023&#39;</span><span class="p">,</span> <span class="s">&#39;*.ipm&#39;</span><span class="p">,</span>
              <span class="s">&#39;*.mdl&#39;</span><span class="p">,</span> <span class="s">&#39;*.stt&#39;</span><span class="p">,</span> <span class="s">&#39;*.rec&#39;</span><span class="p">,</span> <span class="s">&#39;*.aif&#39;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">delete_files</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>


<span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">ft</span> <span class="ow">in</span> <span class="n">file_types</span><span class="p">:</span>
    <span class="n">delete_files</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">ft</span><span class="p">))</span>
</pre></div>


<p>I hope you find these useful. Like I said I use both of these almost every day so I figured it was time to share.</p></p>
        </div>
    
</div> <!-- blog main --!>
</div>
</div>

        </div>

        <div class="row"> <!-- add spacing to bottom of site --!>
        &nbsp
        </div>
    </div> <!--End of container --!>
    </div> <!--End of wrap--!>
    <div id="footer">
        <div class="container">
        <p class="text-muted">&copy; 2016, Jacob Merson</p>
        </div>
    </div>




        <!-- javascript
        ================================================== -->
        <script src="/js/bootstrap.min.js"></script>
        <!-- Google Analytics code --!>
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-48100105-1', 'jacobmerson.com');
          ga('send', 'pageview');

        </script>
        
        
  </body>
</html>