<!DOCTYPE html>
<html lang="en">
      <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" >
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Note: I will try to keep this page up to date, but I won’t guarantee it. Updated software is kept in the git repository here. If you use this software and wa...">
    <meta name="author" content="Jacob Merson">

    <!-- styles -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/main.css" rel="stylesheet">
    <link href="/assets/css/footer.css" rel="stylesheet">
    <link href="/assets/css/blog.css" rel="stylesheet">
    <!-- Style for code syntax highlighting -->
    <link href="/assets/css/highlighting.css" rel="stylesheet">
    <link href="/assets/css/mathjax.css" rel="stylesheet">
    
	<title>Jacob Merson | Abaqus Utilities</title>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <!--[if lt IE 9]>
        <script src="/assets/js/response.min.js"></script>
        <script src="/assets/js/html5.shif.js"></script>
    <![endif]-->

    <!--Add mathjax capability-->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            extensions: ["tex2jax.js"],
            jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
        },
        "HTML-CSS": { availableFonts: ["TeX"] }
        });
        MathJax.Hub.Queue(function() {
            // Fix <code> tags after MathJax finishes running. This is a
            // hack to overcome a shortcoming of Markdown. Discussion at
            // https://github.com/mojombo/jekyll/issues/199
            var all = MathJax.Hub.getAllJax(), i;
            for(i = 0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
  </head>

    <body>
        <div id=wrap>
            <nav class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Jacob Merson</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
                
                
                
                <!-- http://stackoverflow.com/questions/8340170/jekyll-automatically-highlight-current-tab-in-menu-bar#9138259 --!>

  
    
      <li><a href="/index.html">Home</a></li>
    
  

  
    
      <li><a href="/about.html">About</a></li>
    
  

  
    
      <li><a href="/resume.html">Resume</a></li>
    
  

  
    
      <li><a href="/blog/">Blog</a></li>
    
  

  
    
      <li><a href="/contact.html">Contact</a></li>
    
  




          </ul>
        </div><!--/.nav-collapse -->
      </div>
</nav>


            <div class="container">
            <div id="main">
                <div class="container">
<div class="blog-header">
    <h1 class="blog-post-title"> Abaqus Utilities </h1>
    <p class="blog-post-date"> Monday January 18, 2016 </p>
    <p class="blog-post-tags"> abaqus, queue, bash, and python</p>
</div> <!-- blog header --!>
<div class="blog-main">
    
        <div class="blog-post-content">
            <p class="lead"><p>Note: I will try to keep this page up to date, but I won’t guarantee it. Updated software is kept in the git repository <a href="https://gitlab.com/jacob.merson/abaqus-utilities">here</a>. If you use this software and want to help me improve it please submit a merge request.</p>

<p>I am releasing these quick an dirty for today. These are two scripts that I use all the time working with Abaqus.
## Abaqus Queue
This is a queue for running abaqus jobs. The easiest way to use this is by linking the script to a convenient bin location like <code>~/bin</code>. Once this is done you can call the script with all of the jobs you want to run and they will run sequentially.</p>

<p>Here is the whole list of commands you would need to get starting running abaqus jobs.</p>

<pre><code>:::Bash
git clone https://gitlab.com/jacob.merson/abaqus-utilities.git
ln -s abaqus-utilities/run_analysis.sh ~/bin/run_analysis.sh
chmod +x ~/bin/run_analysis.sh
</code></pre>

<p>Now make sure that you have the <code>~/bin</code> folder in your path. You should see the following in your <code>~.bashrc</code></p>

<pre><code>:::Bash
export PATH=$HOME/bin
</code></pre>

<p>Now you should be able to run abaqus jobs in any folder on your system. Change to a folder with a bunch of input files that you want to run and try using the queue.</p>

<pre><code>:::Bash 
run_analysis.sh *.inp
</code></pre>

<h3 id="script">Script</h3>

<pre><code>:::Bash
#!/usr/bin/env bash
#
# run_analysis.sh
# 
# Copyright 2015 Jacob Merson &lt;jacob.merson@gmail.com&gt; 
# 
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
#

TIME=$(date +"%x %r %Z")
#time after which to kill the simulation
#in hours
declare -i SIMULATION_DURATION=1
#convert duration to seconds
SIMULATION_DURATION=$SIMULATION_DURATION*3600
EMAIL="$USER"
MESSAGE="message.txt"
declare -i TERMINATED=0

function kill_job() {
    echo "Terminating $1 at $TIME"
    abaqus terminate job="$1"
    SUBJECT="Job $1 terminated at $TIME"
    echo "Job $1 terminated at $TIME" &gt;&gt; $MESSAGE
}

for f in $@
do
    TIME=$(date +"%x %r %Z")
    echo "Starting job=$f at $TIME"
    echo "Starting job=$f at $TIME" &gt; $MESSAGE
    #set trap to cleanly take care of shutting abaqus down
    trap "kill_job $f" SIGINT
    abaqus job="$f" ask_delete=off
    #sleep for 20 sec to allow abaqus to start
    sleep 20
    #while the lock file exists (simulation running)
    #sleep for 5 sec at a time
    while [ -f ${f}.lck ]; do
        sleep 5
        SIMULATION_DURATION=$SIMULATION_DURATION-5
        #if the simulation has been running for more than the specified time
        #Cleanly terminate the job
        if [ $SIMULATION_DURATION -lt 0 ]
            then
        TIME=$(date +"%x %r %Z")
                kill_job "$f"
                TERMINATED=1
                break
        fi
    done
    if [ $TERMINATED -eq 0 ]
    then
        TIME=$(date +"%x %r %Z")
        SUBJECT="Job $f Completed at $TIME"
        echo "Job $f Completed at $TIME" &gt;&gt; $MESSAGE
    fi
    mail -a "$f.dat" -a "$f.sta" -s "$SUBJECT" "$EMAIL" &lt; $MESSAGE
done

rm "message.txt"
</code></pre>

<h2 id="cleanup-script">Cleanup Script</h2>

<p>This script is a very simple python utility that cleans up all of the abaqus temporary files when you are done with them.</p>

<pre><code>:::Bash
ln -s abaqus-utilities/clean_abaqus.py ~/bin/clean_abaqus.py
chmod +x ~/bin/clean_abaqus.py
</code></pre>

<p>Change to the directory where you ran all of your jobs and all of the files with the extensions listed in the script will be gone. No more wasting time deleting all of those files Abaqus generates.</p>

<pre><code>:::python
#!/usr/bin/env python
#
# clean_abaqus.py
# 
# Copyright 2015 Jacob Merson &lt;jacob.merson@gmail.com&gt; 
# 
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
#

import glob
import os

##############
# This file removes all of the standard abaqus files from
# the current directory
##############

#specify files to delete with glob syntax
file_types = ['*.sta', '*.dat', '*.log','*.rpy','*.rpy.*', '*.msg', '*.dat',
              '*.com', '*.sim','*.log','*.msg', '*.prt', '*.023', '*.ipm',
              '*.mdl', '*.stt', '*.rec', '*.aif']


def delete_files(files):
    for f in files:
        os.remove(f)


files = []

for ft in file_types:
    delete_files(glob.glob(ft))
</code></pre>

<p>I hope you find these useful. Like I said I use both of these almost every day so I figured it was time to share.</p>
</p>
        </div>
    
</div> <!-- blog main --!>
</div>
</div>

            </div>
            <div class="row"> <!-- add spacing to bottom of site --!>
                &nbsp
            </div>
            </div> <!--End of container --!>
        </div> <!--End of wrap--!>
        <footer id="footer">
    <div class="container">
    <p class="text-muted">&copy; 2000-2016, Jacob Merson</p>
    </div>
</footer>

        <!-- javascript -->
<!-- Included at the base to for improved load times --!>
<script src="/assets/js/bootstrap.min.js"></script>

        <!-- Google Analytics code --!>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-48100105-1', 'jacobmerson.com' );
ga('send', 'pageview');

</script>

    </body>
</html>
